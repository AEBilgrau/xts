<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Plotting Panels</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>

<style type="text/css">

/* padding for bootstrap navbar */
body {
  padding-top: 50px;
  padding-bottom: 40px;
}


/* offset scroll position for anchor links (for fixed navbar)  */
.section h2 {
  padding-top: 55px;
  margin-top: -55px;
}
.section h3 {
  padding-top: 55px;
  margin-top: -55px;
}



/* don't use link color in navbar */
.dropdown-menu>li>a {
  color: black;
}

/* some padding for disqus
#disqus_thread {
  margin-top: 45px;
}
*/

</style>

<link rel="stylesheet" href="libs/font-awesome-4.1.0/css/font-awesome.min.css"/>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="libs/highlight/textmate.css"
      type="text/css" />
<script src="libs/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <!-- add the xts version here? -->
      <a class="navbar-brand" href="index.html">xts</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
      <!-- Home item -->
        <li><a href="index.html">Home</a></li>
        <!-- plotting dropdown -->
        <li class="dropdown">
          <a href="plotting" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Plotting <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">plot.xts</li>
             <li><a href="plotting_basics.html">Plotting Basics</a></li>
             <li><a href="plotting_panels.html">Plotting Panels</a></li>
             <!-- 
             add more plotting items
             <li><a href="authoring_pandoc_markdown.html">Pandoc Markdown</a></li>
             <li><a href="authoring_rcodechunks.html">R Code Chunks</a></li>
             <li><a href="authoring_bibliographies_and_citations.html">Bibliographies &amp; Citations</a></li>
             <li><a href="authoring_migrating_from_v1.html">Migrating from v1</a></li>
             <li class="divider"></li>
             <li><a href="http://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">Cheat Sheet [PDF]</a></li>
             <li><a href="http://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">Reference Guide [PDF]</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Shiny</li>
             <li><a href="authoring_shiny.html">Interactive Documents</a></li>
             <li><a href="authoring_embedded_shiny.html">Embedded Shiny Apps</a></li>
             <li><a href="authoring_shiny_widgets.html">Creating Shiny Widgets</a></li>
             <li><a href="authoring_shiny_advanced.html">Advanced Topics</a></li>
             -->
          </ul>
        </li>
        <!-- add another dropdown menu -->
        <li class="dropdown">
          <a href="faq" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">FAQ <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li class="dropdown-header">FAQ</li>
             <li><a href="xts_faq.html">xts FAQ</a></li>
             <!--
             <li><a href="pdf_document_format.html">PDF</a></li>
             <li><a href="word_document_format.html">Word</a></li>
             <li><a href="markdown_document_format.html">Markdown</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Presentations</li>
             <li><a href="ioslides_presentation_format.html">ioslides</a></li>
             <li><a href="slidy_presentation_format.html">Slidy</a></li>
             <li><a href="beamer_presentation_format.html">Beamer</a></li>
             <li class="divider"></li>
             <li class="dropdown-header">Other</li>
             <li><a href="package_vignette_format.html">Package Vignette</a></li>
             <li><a href="tufte_handout_format.html">Tufte Handout</a></li>
             <li class="divider"></li>
             <li><a href="r_notebook_format.html">R Notebooks</a></li>
          </ul>
        </li>
        -->
        <!-- add another dropdown menu
         <li class="dropdown">
          <a href="developer" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Developer <span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
             <li><a href="developer_html_widgets.html">HTML Widgets</a></li>
             <li class="divider"></li>
             <li><a href="developer_document_templates.html">Document Templates</a></li>
             <li><a href="developer_custom_formats.html">Creating New Formats</a></li>
             <li class="divider"></li>
             <li><a href="https://github.com/rstudio/rmarkdown">R Markdown on GitHub</a></li>
          </ul>
        </li>
        -->
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">
<h1 class="title">Plotting Panels</h1>
</div>


<div id="panel-basics" class="section level3">
<h3>Panel Basics</h3>
<p>Load the xts package and some sample OHLC data. The PerformanceAnalytics package is loaded for functions that will be used in the examples and the edhec dataset of EDHEC composite hedge fund style index returns.</p>
<pre class="r"><code>library(xts)</code></pre>
<pre><code>## Loading required package: zoo
## 
## Attaching package: &#39;zoo&#39;
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre class="r"><code>library(PerformanceAnalytics)</code></pre>
<pre><code>## 
## Attaching package: &#39;PerformanceAnalytics&#39;
## 
## The following object is masked from &#39;package:graphics&#39;:
## 
##     legend</code></pre>
<pre class="r"><code>data(sample_matrix)
sample.xts &lt;- as.xts(sample_matrix)</code></pre>
<p>Create a basic plot and add a panel of the simple returns</p>
<pre class="r"><code>plot(sample.xts[,&quot;Close&quot;])
lines(Return.calculate(sample.xts[,&quot;Close&quot;]), type=&quot;h&quot;, on=NA)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-3.png" title="plot of chunk unnamed-chunk-3" alt="plot of chunk unnamed-chunk-3" width="672" /></p>
<p>Instead of calculating the returns and plotting the result, an alternative is to use <code>addPanel</code> which is useful for applying a function to the raw data in the current plot object. Note that <code>addPanel</code> accepts a function, it does not accept data like <code>lines</code> and <code>points</code>. The raw data in the current plot object is passed to the first argument in <code>FUN</code>. Additional arguments to <code>FUN</code> are passed via dots (<code>...</code>).</p>
<pre class="r"><code># plot the Close
plot(sample.xts[,&quot;Close&quot;], col=&quot;blue&quot;)

# calculate returns
addPanel(Return.calculate, method=&quot;discrete&quot;, type=&quot;h&quot;)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-4.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="672" /></p>
<p>We can also create the same plot by using the <code>panels</code> argument.</p>
<pre class="r"><code>plot(sample.xts[,&quot;Close&quot;], 
     panels=&#39;lines(Return.calculate(sample.xts[,&quot;Close&quot;]), type=&quot;h&quot;, on=NA)&#39;)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-5.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="672" /></p>
</div>
<div id="multiple-panels" class="section level3">
<h3>Multiple Panels</h3>
<p>Load the edhec data from PerformanceAnalytics. Here will use the first 4 columns of the edhec returns data to demonstrate panel and small multiples functionality.</p>
<pre class="r"><code>data(edhec)
R &lt;- edhec[,1:4]
head(R)</code></pre>
<pre><code>## Warning: index class is Date, which does not support timezones.
## Expected &#39;UTC&#39; timezone, but indexTZ is GMT</code></pre>
<pre><code>##            Convertible Arbitrage CTA Global Distressed Securities
## 1997-01-31                0.0119     0.0393                0.0178
## 1997-02-28                0.0123     0.0298                0.0122
## 1997-03-31                0.0078    -0.0021               -0.0012
## 1997-04-30                0.0086    -0.0170                0.0030
## 1997-05-31                0.0156    -0.0015                0.0233
## 1997-06-30                0.0212     0.0085                0.0217
##            Emerging Markets
## 1997-01-31           0.0791
## 1997-02-28           0.0525
## 1997-03-31          -0.0120
## 1997-04-30           0.0119
## 1997-05-31           0.0315
## 1997-06-30           0.0581</code></pre>
<p>To plot each column in a separate panel, specify <code>multi.panel = TRUE</code>. The default behavior is to use the same range for the y-axis for each panel.</p>
<pre class="r"><code>plot(R, multi.panel=TRUE, type=&quot;h&quot;)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-7.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" width="672" /></p>
<p>Plot each column of data in a separate panel, setting the range of the y-axis for each panel based on each column of data. Note how each panel has a different y-axis range.</p>
<pre class="r"><code>plot(R, multi.panel=TRUE, type=&quot;h&quot;, yaxis.same=FALSE)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-8.png" title="plot of chunk unnamed-chunk-8" alt="plot of chunk unnamed-chunk-8" width="672" /></p>
<p>Attributes such as <code>col</code>, <code>lty</code>, and <code>lwd</code> are passed to each panel.</p>
<pre class="r"><code>plot(R, multi.panel=TRUE, col=c(&quot;black&quot;, &quot;blue&quot;, &quot;red&quot;, &quot;green&quot;), lty=1:4)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-9.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" width="672" /></p>
<p>An important feature of <code>plot.xts</code> is that it does not use <code>layout</code> internally for panels. This means that <code>plot.xts</code> is “layout safe” and multiple panels can be plotted in a specified layout for custom plots.</p>
<p>Plot the returns data in a 1x2 panel.</p>
<pre class="r"><code>layout(matrix(1:2, 1, 2))
plot(R, multi.panel=2, type=&quot;h&quot;)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-10.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" width="672" /></p>
<pre class="r"><code>layout(matrix(1))</code></pre>
<p>Plot the returns data in a 2x2 panel.</p>
<pre class="r"><code>layout(matrix(1:4, 2, 2))
plot(R, multi.panel=1, type=&quot;h&quot;)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-11.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" width="672" /></p>
<pre class="r"><code>layout(matrix(1))</code></pre>
</div>
<div id="custom-panels" class="section level3">
<h3>Custom Panels</h3>
<p>Define a custom function to add a drawdowns panel.</p>
<pre class="r"><code>addDrawdowns &lt;- function(main = &quot;Drawdowns&quot;, col=&quot;black&quot;, on=NA, ...){
  # Get the current charting object (i.e. chob) and extract the data
  plot_object &lt;- xts:::current.xts_chob()
  x &lt;- plot_object$Env$xdata
  
  # compute the drawdowns
  dd &lt;- PerformanceAnalytics:::Drawdowns(x)
  # simply call addSeries with the computed data 
  addSeries(dd, main=main, col=col, on=on, ...)
}</code></pre>
<pre class="r"><code>plot(R[,1], type=&quot;h&quot;)
addDrawdowns()</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-13.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" width="672" /></p>
<p>Multiple panels of returns with the custom drawdowns panel.</p>
<pre class="r"><code>layout(matrix(1:4, 2, 2))
plot(R, type=&quot;h&quot;, multi.panel=1, panels=&quot;addDrawdowns()&quot;)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-14.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" width="672" /></p>
<pre class="r"><code>layout(matrix(1))</code></pre>
<p>Another example of a custom panel function is to add a rolling Expected Shortfall to the main panel.</p>
<pre class="r"><code>addrollingES &lt;- function(gap=50, p=0.95, method=&quot;historical&quot;, on=1, ...){
  # Get the current charting object (i.e. chob) and extract the data
  plot_object &lt;- xts:::current.xts_chob()
  x &lt;- plot_object$Env$xdata
  
  # compute the rolling Expected Shortfall
  rollingES &lt;- as.xts(apply.fromstart(x, FUN=&quot;ES&quot;, gap=gap, p=p, method=method))
  # simply call addSeries with the computed data 
  addSeries(rollingES, on=on, ...)
}</code></pre>
<pre class="r"><code>plot(R[,1], type=&quot;h&quot;, main=&quot;Convertible Arbitrage Returns&quot;)
addrollingES(lty=2, col=&quot;blue&quot;, lwd=2)
addLegend(&quot;topleft&quot;, legend.names = &quot;Historical 95% ES&quot;, 
          lty=2, lwd=2, col=&quot;blue&quot;)</code></pre>
<p><img src="plotting_panels_files/figure-html/unnamed-chunk-16.png" title="plot of chunk unnamed-chunk-16" alt="plot of chunk unnamed-chunk-16" width="672" /></p>
</div>


<!-- some extra javascript for older browsers -->
<script type="text/javascript" src="libs/polyfill.js"></script>

<script>

// manage active state of menu based on current page
$(document).ready(function () {

    // active menu
    href = window.location.pathname
    href = href.substr(href.lastIndexOf('/') + 1)
    $('a[href="' + href + '"]').parent().addClass('active');

    // manage active menu header
    if (href.startsWith('plotting_'))
      $('a[href="' + 'plotting' + '"]').parent().addClass('active');
    else if (href.endsWith('_faq.html'))
      $('a[href="' + 'formats' + '"]').parent().addClass('active');
    else if (href.startsWith('developer_'))
      $('a[href="' + 'developer' + '"]').parent().addClass('active');

});

</script>

<!-- disqus
  <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rmarkdown'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
-->

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
